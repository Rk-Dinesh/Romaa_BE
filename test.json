

{
  "status": true,
  "message": "Schedule dates and durations updated successfully",
  "data": {
    "_id": "69466e0e72b1a5f616084c17",
    "tender_id": "TND0016",
    "items": [
      {
        "wbs_id": "WBS013",
        "description": "Foundation Excavation",
        "unit": "m³",
        "quantity": 70,
        "executed_quantity": 0,
        "balance_quantity": 70,
        "duration": 23,
        "revised_duration": 26,
        "start_date": "2025-12-06T00:00:00.000Z",
        "end_date": "2025-12-28T00:00:00.000Z",
        "revised_end_date": "2025-12-31T00:00:00.000Z",
        "lag": 4,
        "status": "pending",
        "daily": [
          {
            "date": "2025-12-06T00:00:00.000Z",
            "quantity": 0
          },
          {
            "date": "2025-12-07T00:00:00.000Z",
            "quantity": 0
          },
          {
            "date": "2025-12-08T00:00:00.000Z",
            "quantity": 0
          },
          {
            "date": "2025-12-09T00:00:00.000Z",
            "quantity": 0
          },
          {
            "date": "2025-12-10T00:00:00.000Z",
            "quantity": 0
          },
          {
            "date": "2025-12-11T00:00:00.000Z",
            "quantity": 0
          },
          {
            "date": "2025-12-12T00:00:00.000Z",
            "quantity": 0
          },
          {
            "date": "2025-12-13T00:00:00.000Z",
            "quantity": 0
          },
          {
            "date": "2025-12-14T00:00:00.000Z",
            "quantity": 0
          },
          {
            "date": "2025-12-15T00:00:00.000Z",
            "quantity": 0
          },
          {
            "date": "2025-12-16T00:00:00.000Z",
            "quantity": 0
          },
          {
            "date": "2025-12-17T00:00:00.000Z",
            "quantity": 0
          },
          {
            "date": "2025-12-18T00:00:00.000Z",
            "quantity": 0
          },
          {
            "date": "2025-12-19T00:00:00.000Z",
            "quantity": 0
          },
          {
            "date": "2025-12-20T00:00:00.000Z",
            "quantity": 0
          },
          {
            "date": "2025-12-21T00:00:00.000Z",
            "quantity": 0
          },
          {
            "date": "2025-12-22T00:00:00.000Z",
            "quantity": 0
          },
          {
            "date": "2025-12-23T00:00:00.000Z",
            "quantity": 0
          },
          {
            "date": "2025-12-24T00:00:00.000Z",
            "quantity": 0
          },
          {
            "date": "2025-12-25T00:00:00.000Z",
            "quantity": 0
          },
          {
            "date": "2025-12-26T00:00:00.000Z",
            "quantity": 0
          },
          {
            "date": "2025-12-27T00:00:00.000Z",
            "quantity": 0
          },
          {
            "date": "2025-12-28T00:00:00.000Z",
            "quantity": 0
          },
          {
            "date": "2025-12-29T00:00:00.000Z",
            "quantity": 0
          },
          {
            "date": "2025-12-30T00:00:00.000Z",
            "quantity": 0
          },
          {
            "date": "2025-12-31T00:00:00.000Z",
            "quantity": 0
          }
        ],
        "weekly": {
          //start_date = 2025-12-06T00:00:00.000Z , revised_end_date = 2025-12-31T00:00:00.000Z = 26 days 
          //working_quantity_per_day =(quantity/revised_duration) = 70/26 = 2.69, total_planned_quantity = working_quantity_per_day * duration = 2.69 * 26 = 28                 
          "firstweek": {
            "achieved_quantity": 0,
            "planned_quantity": 5.38, // total_planned_quantity = working_quantity_per_day * duration = 2.69 * 2 = 5.38
            "lag_quantity": 5.38
          },
          "secondweek": {
            "achieved_quantity": 0,
            "planned_quantity": 18.85,// total_planned_quantity = working_quantity_per_day * duration = 2.69 * 7 = 18.85
            "lag_quantity": 18.85
          },
          "thirdweek": {
            "achieved_quantity": 0,
            "planned_quantity": 18.85,// total_planned_quantity = working_quantity_per_day * duration = 2.69 * 7 = 18.85
            "lag_quantity": 18.85
          },
          "fourthweek": {
            "achieved_quantity": 0,
            "planned_quantity": 26.92,// total_planned_quantity = working_quantity_per_day * duration = 2.69 * 10 = 26.92
            "lag_quantity": 26.92
          }
          //total_planned_quantity = firstweek + secondweek + thirdweek + fourthweek = 5.38 + 18.85 + 18.85 + 26.92 = 69.0
        },
        "monthly": {
          "planned_quantity": 70,
          "achieved_quantity": 0
        }
      },
      {
        "wbs_id": "WBS014",
        "description": "Concrete Pour",
        "unit": "m³",
        "quantity": 140,
        "executed_quantity": 0,
        "balance_quantity": 140,
        "duration": 9,
        "revised_duration": 9,
        "start_date": "2025-12-05T00:00:00.000Z",
        "end_date": "2025-12-13T00:00:00.000Z",
        "revised_end_date": "2025-12-13T00:00:00.000Z",
        "lag": 1,
        "status": "pending",
        "daily": [
          {
            "date": "2025-12-05T00:00:00.000Z",
            "quantity": 0
          },
          {
            "date": "2025-12-06T00:00:00.000Z",
            "quantity": 0
          },
          {
            "date": "2025-12-07T00:00:00.000Z",
            "quantity": 0
          },
          {
            "date": "2025-12-08T00:00:00.000Z",
            "quantity": 0
          },
          {
            "date": "2025-12-09T00:00:00.000Z",
            "quantity": 0
          },
          {
            "date": "2025-12-10T00:00:00.000Z",
            "quantity": 0
          },
          {
            "date": "2025-12-11T00:00:00.000Z",
            "quantity": 0
          },
          {
            "date": "2025-12-12T00:00:00.000Z",
            "quantity": 0
          },
          {
            "date": "2025-12-13T00:00:00.000Z",
            "quantity": 0
          }
        ],
        "weekly": {
          //start_date = 2025-12-05T00:00:00.000Z , revised_end_date = 2025-12-13T00:00:00.000Z = 9 days 
          //working_quantity_per_day =(quantity/revised_duration) = 140/9 = 15.56, total_planned_quantity = working_quantity_per_day * duration = 15.56 * 9 = 140                 
          "firstweek": {
            "achieved_quantity": 0,
            "planned_quantity": 46.67, // total_planned_quantity = working_quantity_per_day * duration = 15.56 * 3 = 46.67
            "lag_quantity": 46.67
          },
          "secondweek": {
            "achieved_quantity": 0,
            "planned_quantity": 93.33, // total_planned_quantity = working_quantity_per_day * duration = 15.56 * 6 = 93.33
            "lag_quantity": 93.33
          },
          "thirdweek": {
            "achieved_quantity": 0,
            "planned_quantity": 0, // total_planned_quantity = working_quantity_per_day * duration = 15.56 * 0 = 0
            "lag_quantity": 0
          },
          "fourthweek": {
            "achieved_quantity": 0,
            "planned_quantity": 0, // total_planned_quantity = working_quantity_per_day * duration = 15.56 * 0 = 0
            "lag_quantity": 0
          }
          //total_planned_quantity = firstweek + secondweek + thirdweek + fourthweek = 46.67 + 93.33 + 0 + 0 = 140
        },
        "monthly": {
          "planned_quantity": 140,
          "achieved_quantity": 0
        }
      },
      {
        "wbs_id": "WBS015",
        "description": "Brick Laying",
        "unit": "m²",
        "quantity": 210,
        "executed_quantity": 0,
        "balance_quantity": 210,
        "duration": 5,
        "revised_duration": 6,
        "start_date": "2025-12-08T00:00:00.000Z",
        "end_date": "2025-12-12T00:00:00.000Z",
        "revised_end_date": "2025-12-13T00:00:00.000Z",
        "lag": 2,
        "status": "pending",
        "daily": [
          {
            "date": "2025-12-08T00:00:00.000Z",
            "quantity": 0
          },
          {
            "date": "2025-12-09T00:00:00.000Z",
            "quantity": 0
          },
          {
            "date": "2025-12-10T00:00:00.000Z",
            "quantity": 0
          },
          {
            "date": "2025-12-11T00:00:00.000Z",
            "quantity": 0
          },
          {
            "date": "2025-12-12T00:00:00.000Z",
            "quantity": 0
          },
          {
            "date": "2025-12-13T00:00:00.000Z",
            "quantity": 0
          }
        ],
        "weekly": {
          //start_date = 2025-12-08T00:00:00.000Z , revised_end_date = 2025-12-13T00:00:00.000Z = 6 days 
          //working_quantity_per_day =(quantity/revised_duration) = 210/6 = 35, total_planned_quantity = working_quantity_per_day * duration = 35 * 6 = 210                 
          "firstweek": {
            "achieved_quantity": 0,
            "planned_quantity": 0,// total_planned_quantity = working_quantity_per_day * duration = 35 * 0 = 0
            "lag_quantity": 0
          },
          "secondweek": {
            "achieved_quantity": 0,
            "planned_quantity": 210,// total_planned_quantity = working_quantity_per_day * duration = 35 * 6 = 210
            "lag_quantity": 210
          },
          "thirdweek": {
            "achieved_quantity": 0,
            "planned_quantity": 0,// total_planned_quantity = working_quantity_per_day * duration = 35 * 0 = 0
            "lag_quantity": 0
          },
          "fourthweek": {
            "achieved_quantity": 0,
            "planned_quantity": 0,// total_planned_quantity = working_quantity_per_day * duration = 35 * 0 = 0
            "lag_quantity": 0
          }
          //total_planned_quantity = firstweek + secondweek + thirdweek + fourthweek = 0 + 210 + 0 + 0 = 210
        },
        "monthly": {
          "planned_quantity": 210,
          "achieved_quantity": 0
        }
      }
    ],
    "createdAt": "2025-12-20T09:36:14.960Z",
    "updatedAt": "2025-12-20T09:36:46.592Z",
    "__v": 0
  }
}

{
  "tender_id": "TND020",
  "items": [
    {
      "wbs_id": "WBS037",
      "description": "Foundation Excavation",
      "unit": "m³",
      "quantity": 70,
      "executed_quantity": 1,
      "balance_quantity": 69,
      "duration": 23,
      "revised_duration": 23,
      "start_date": {
        "$date": "2025-12-06T00:00:00.000Z"
      },
      "end_date": {
        "$date": "2025-12-28T00:00:00.000Z"
      },
      "revised_end_date": {
        "$date": "2025-12-28T00:00:00.000Z"
      },
      "lag": 0,
      "status": "inprogress",
      "daily": [
        {
          "date": {
            "$date": "2025-12-06T00:00:00.000Z"
          },
          "quantity": 0
        },
        {
          "date": {
            "$date": "2025-12-07T00:00:00.000Z"
          },
          "quantity": 0
        },
        {
          "date": {
            "$date": "2025-12-08T00:00:00.000Z"
          },
          "quantity": 0
        },
        {
          "date": {
            "$date": "2025-12-09T00:00:00.000Z"
          },
          "quantity": 0
        },
        {
          "date": {
            "$date": "2025-12-10T00:00:00.000Z"
          },
          "quantity": 0
        },
        {
          "date": {
            "$date": "2025-12-11T00:00:00.000Z"
          },
          "quantity": 0
        },
        {
          "date": {
            "$date": "2025-12-12T00:00:00.000Z"
          },
          "quantity": 0
        },
        {
          "date": {
            "$date": "2025-12-13T00:00:00.000Z"
          },
          "quantity": 0
        },
        {
          "date": {
            "$date": "2025-12-14T00:00:00.000Z"
          },
          "quantity": 0
        },
        {
          "date": {
            "$date": "2025-12-15T00:00:00.000Z"
          },
          "quantity": 0
        },
        {
          "date": {
            "$date": "2025-12-16T00:00:00.000Z"
          },
          "quantity": 0
        },
        {
          "date": {
            "$date": "2025-12-17T00:00:00.000Z"
          },
          "quantity": 0
        },
        {
          "date": {
            "$date": "2025-12-18T00:00:00.000Z"
          },
          "quantity": 0
        },
        {
          "date": {
            "$date": "2025-12-19T00:00:00.000Z"
          },
          "quantity": 0
        },
        {
          "date": {
            "$date": "2025-12-20T00:00:00.000Z"
          },
          "quantity": 0
        },
        {
          "date": {
            "$date": "2025-12-21T00:00:00.000Z"
          },
          "quantity": 0
        },
        {
          "date": {
            "$date": "2025-12-22T00:00:00.000Z"
          },
          "quantity": 0
        },
        {
          "date": {
            "$date": "2025-12-23T00:00:00.000Z"
          },
          "quantity": 0
        },
        {
          "date": {
            "$date": "2025-12-24T00:00:00.000Z"
          },
          "quantity": 0
        },
        {
          "date": {
            "$date": "2025-12-25T00:00:00.000Z"
          },
          "quantity": 0
        },
        {
          "date": {
            "$date": "2025-12-26T00:00:00.000Z"
          },
          "quantity": 0
        },
        {
          "date": {
            "$date": "2025-12-27T00:00:00.000Z"
          },
          "quantity": 0
        },
        {
          "date": {
            "$date": "2025-12-28T00:00:00.000Z"
          },
          "quantity": 0
        }
      ],
      "schedule_data": [
        {
          "month_name": "December",
          "year": 2025,
          "month_key": "12-2025",
          "metrics": {
            "achieved_quantity": 0,
            "planned_quantity": 70,
            "lag_quantity": 70
          },
          "weeks": [
            //start_date = 2025-12-06T00:00:00.000Z , revised_end_date = 2025-12-28T00:00:00.000Z = 29 days 
            //working_quantity_per_day =(quantity/revised_duration) = 70/29 = 2.41, total_planned_quantity = working_quantity_per_day * duration = 2.41 * 29 = 70 
            {
              "week_label": "firstweek", // 1-7
              "week_number": 1,
              "metrics": {
                "achieved_quantity": 0,
                "planned_quantity": 6.08,// total_planned_quantity = working_quantity_per_day * duration = 3.04 * 2 = 6.08
                "lag_quantity": 6.08
              }
            },
            {
              "week_label": "secondweek",//7-14
              "week_number": 2,
              "metrics": {
                "achieved_quantity": 0,
                "planned_quantity": 21.3,// total_planned_quantity = working_quantity_per_day * duration = 3.04 * 7 = 21.28
                "lag_quantity": 21.3
              }
            },
            {
              "week_label": "thirdweek",//15-21
              "week_number": 3,
              "metrics": {
                "achieved_quantity": 0,
                "planned_quantity": 21.3,// total_planned_quantity = working_quantity_per_day * duration = 3.04 * 7 = 21.28
                "lag_quantity": 21.3
              }
            },
            {
              "week_label": "fourthweek",
              "week_number": 4,
              "metrics": {
                "achieved_quantity": 0,
                "planned_quantity": 21.3, // total_planned_quantity = working_quantity_per_day * duration = 3.04 * 7 = 21.28
                "lag_quantity": 21.3
              }
            }
          ]
        }
      ]
    },
    {
      "wbs_id": "WBS038",
      "description": "Concrete Pour",
      "unit": "m³",
      "quantity": 140,
      "executed_quantity": 0,
      "balance_quantity": 140,
      "duration": 9,
      "revised_duration": 9,
      "start_date": {
        "$date": "2025-12-05T00:00:00.000Z"
      },
      "end_date": {
        "$date": "2025-12-13T00:00:00.000Z"
      },
      "revised_end_date": {
        "$date": "2025-12-13T00:00:00.000Z"
      },
      "lag": 0,
      "status": "pending",
      "daily": [
        {
          "date": {
            "$date": "2025-12-05T00:00:00.000Z"
          },
          "quantity": 0
        },
        {
          "date": {
            "$date": "2025-12-06T00:00:00.000Z"
          },
          "quantity": 0
        },
        {
          "date": {
            "$date": "2025-12-07T00:00:00.000Z"
          },
          "quantity": 0
        },
        {
          "date": {
            "$date": "2025-12-08T00:00:00.000Z"
          },
          "quantity": 0
        },
        {
          "date": {
            "$date": "2025-12-09T00:00:00.000Z"
          },
          "quantity": 0
        },
        {
          "date": {
            "$date": "2025-12-10T00:00:00.000Z"
          },
          "quantity": 0
        },
        {
          "date": {
            "$date": "2025-12-11T00:00:00.000Z"
          },
          "quantity": 0
        },
        {
          "date": {
            "$date": "2025-12-12T00:00:00.000Z"
          },
          "quantity": 0
        },
        {
          "date": {
            "$date": "2025-12-13T00:00:00.000Z"
          },
          "quantity": 0
        }
      ],
      "schedule_data": [

        {
          "month_name": "December",
          "year": 2025,
          "month_key": "12-2025",
          "metrics": {
            "achieved_quantity": 0,
            "planned_quantity": 140,
            "lag_quantity": 140
          },
          "weeks": [
            //start_date = 2025-12-05T00:00:00.000Z , revised_end_date = 2025-12-13T00:00:00.000Z = 9 days 
          //working_quantity_per_day =(quantity/revised_duration) = 140/9 = 15.56, total_planned_quantity = working_quantity_per_day * duration = 15.56 * 9 = 140 
            {
              "week_label": "firstweek",
              "week_number": 1,
              "metrics": {
                "achieved_quantity": 0,
                "planned_quantity": 46.67,// total_planned_quantity = working_quantity_per_day * duration = 15.56 * 3 = 46.67
                "lag_quantity": 46.67
              }
            },
            {
              "week_label": "secondweek",
              "week_number": 2,
              "metrics": {
                "achieved_quantity": 0,
                "planned_quantity": 93.33,// total_planned_quantity = working_quantity_per_day * duration = 15.56 * 6 = 93.33
                "lag_quantity": 93.33
              }
            },
            {
              "week_label": "thirdweek",
              "week_number": 3,
              "metrics": {
                "achieved_quantity": 0,
                "planned_quantity": 0,
                "lag_quantity": 0
              }
            },
            {
              "week_label": "fourthweek",
              "week_number": 4,
              "metrics": {
                "achieved_quantity": 0,
                "planned_quantity": 0,
                "lag_quantity": 0
              }
            }
            //total_planned_quantity = firstweek + secondweek + thirdweek + fourthweek = 46.67 + 93.33 + 0 + 0 = 140 
          ]
        }
      ]
    },
    {
      "wbs_id": "WBS039",
      "description": "Brick Laying",
      "unit": "m²",
      "quantity": 210,
      "executed_quantity": 0,
      "balance_quantity": 210,
      "duration": 5,
      "revised_duration": 6,
      "start_date": {
        "$date": "2025-12-08T00:00:00.000Z"
      },
      "end_date": {
        "$date": "2025-12-12T00:00:00.000Z"
      },
      "revised_end_date": {
        "$date": "2025-12-13T00:00:00.000Z"
      },
      "lag": 1,
      "status": "pending",
      "daily": [
        {
          "date": {
            "$date": "2025-12-08T00:00:00.000Z"
          },
          "quantity": 0
        },
        {
          "date": {
            "$date": "2025-12-09T00:00:00.000Z"
          },
          "quantity": 0
        },
        {
          "date": {
            "$date": "2025-12-10T00:00:00.000Z"
          },
          "quantity": 0
        },
        {
          "date": {
            "$date": "2025-12-11T00:00:00.000Z"
          },
          "quantity": 0
        },
        {
          "date": {
            "$date": "2025-12-12T00:00:00.000Z"
          },
          "quantity": 0
        },
        {
          "date": {
            "$date": "2025-12-13T00:00:00.000Z"
          },
          "quantity": 0
        }
      ],
      "schedule_data": [
        {
          "month_name": "December",
          "year": 2025,
          "month_key": "12-2025",
          "metrics": {
            "achieved_quantity": 0,
            "planned_quantity": 210,
            "lag_quantity": 210
          },
          "weeks": [
            {
              "week_label": "firstweek",
              "week_number": 1,
              "metrics": {
                "achieved_quantity": 0,
                "planned_quantity": 0,
                "lag_quantity": 0
              }
            },
            {
              "week_label": "secondweek",
              "week_number": 2,
              "metrics": {
                "achieved_quantity": 0,
                "planned_quantity": 210,
                "lag_quantity": 210
              }
            },
            {
              "week_label": "thirdweek",
              "week_number": 3,
              "metrics": {
                "achieved_quantity": 0,
                "planned_quantity": 0,
                "lag_quantity": 0
              }
            },
            {
              "week_label": "fourthweek",
              "week_number": 4,
              "metrics": {
                "achieved_quantity": 0,
                "planned_quantity": 0,
                "lag_quantity": 0
              }
            }
          ]
        }
      ]
    }
  ],
  "createdAt": {
    "$date": "2025-12-21T12:35:41.212Z"
  },
  "updatedAt": {
    "$date": "2025-12-21T13:17:41.813Z"
  },
  "__v": 6
}


// let original start date OS 7/12/2025
// let Original end date OE 13/12/2025
// let revised start date RS 8/12/2025
// let revised end date RE 14/12/2025

// on double click on Original end date OE:
//ask want to revise start date or revise end date 
// if revise start date ,revise the date and update the revised end date RE
// if revise end date ,revise the date and update the revised start date RS

//In original end date OE , revised end date RE and revised start date RS can be there,

//On double click between OS and OE, i can able to revise start date
//RS can be from 7/12/2025 to 13/12/2025 (possible dates 7/12/2025, 8/12/2025, 9/12/2025, 10/12/2025, 11/12/2025, 12/12/2025, 13/12/2025) but not above 13/12/2025 and not below 7/12/2025
//if RS delayed one day ask want to extend RE by one day if yes update RE by one day else update RS by one day 
//if RS is backward one day just update RS by one day (if RS is in 11/12/2025 i can go upto 10/12/2025,9/12/2025,8/12/2025,7/12/2025)

//on double click above OE i can able to revise end date
// can be from 13/12/2025 to etc... (possible dates 13/12/2025, 14/12/2025, 15/12/2025, etc...)
//but not below OE (not allowed dates 12/12/2025, 11/12/2025, 10/12/2025, 9/12/2025, 8/12/2025, 7/12/2025...)

// first week 1-7
// second week 8-14
// third week 15-21
// fourth week 22-28

static async updateDrawingQuantity(tender_id, item_code, drawing_quantity) {
  const boq = await BoqModel.findOne({ tender_id });
  if (!boq) throw new Error("BOQ record not found");

  const item = boq.items.find(item => item.item_code === item_code);
  if (!item) throw new Error("Item not found");

  item.drawing_quantity = drawing_quantity;
  item.variable_quantity = item.quantity - drawing_quantity;
  item.variable_amount = item.variable_quantity * item.n_rate;

  return await boq.save();
}